---
title: 外部排序
date: 2018-05-05 08:42:00
categories: Algs
tags: [Sort, Algs]
---
对数据量太大而不能全部放在内存中的关系的排序称为外排序（external sorting），比如数据库索引、文件系统等。外排序中最常用的是 **外部排序归并（external sort-merge）** 算法。
示例：100M 内存情况下，排序 900MB 数据 
1. 读入 100MB 数据到内存，用某种常规内存排序（快排、堆排、归并等）完成排序（这里不考虑排序算法的空间复杂度，如果考虑，减少每次读入数据量）；
2. 将排序好的数据写回磁盘，产生一个临时文件块；
3. 重复步骤 1、2，直到完成所有数据都完成排序并写回。此时有 9 个 100MB 的已排序临时文件；
4. 读入每个临时文件的前 10 MB（10 = 100 / （9 + 1））数据放入内存的输入缓冲区，最后 10MB 作为输出缓冲区（实践中，将输入缓冲区适当调小，将输出缓冲区适当调大，效果更好）；
5. 执行 9 路归并，将结果输出到输出缓冲区。当缓冲区满，将其中的数据写回目标文件，清空缓冲区。过程中一旦 9 个输入缓冲区的某个变空，就从这个缓冲区关联的文件，再读入下一个 10 MB 数据，直到该文件被全部读入。最终所有数据被归并，写回目标文件，完成排序。