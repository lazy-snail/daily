---
title: 进程同步
date: 2018-06-18 23:56:51
categories: OS
tags: OS
---
[toc]
# 进程同步
进程间同步是指进程间的 **协作关系**。
进程同步，Synchronization，指系统中多个进程中发生的事件存在 **某种时序关系**，需要相互合作，共同完成一项任务。具体来说，一个进程运行到某一个点时，需要另一个进程为它提供消息，在未获得该消息之前，该进程进入阻塞状态，获得消息之后被唤醒进入就绪状态。
**进程互斥是一种特殊的进程同步关系**，即逐次使用互斥共享资源，也是对进程使用资源次序上的一种协调。
进程同步机制的实现方法主要有：信号量、管程、互斥、事件。

## 信号量
信号量能够实现互斥，提供同步功能。要求忙等待。它允许多个线程在同一时刻访问同一资源，但是需要限制在同一时刻访问此资源的最大线程数目。

## 管程
在程序设计语言中引入的一种成分，作为一种高级同步原语，是语言概念。定义：
* 是一个特殊的模块
* 有一个名字
* 由关于共享资源的数据结构及在其上操作的一组过程组成
{% asset_img 管程结构.PNG 管程结构 %}

### 保证
* 互斥
管程有一个重要特性：**任一时刻管程中只有一个活跃进程**。这使得管程能有效完成互斥，保证管程中数据结构的数据完整性。其互斥性是由 **编译器** 负责保证的（管程本身是语言概念）。
* 同步
管程中设置 **条件变量及等待/唤醒操作** 来解决同步问题。让进程在条件变量上等待或者通过发送信号将等待在条件变量上的进程/线程唤醒。

### 与进程的关系
进程只能通过调用管程提供的各种过程，间接地使用管程中的数据结构。

## 互斥
进程间互斥是指进程间的 **竞争关系**。
进程间需要共享一些资源（变量、文件等），而这些资源需要 **排他性使用**，所以进程间对这些资源由竞争关系，这种竞争即称为“进程互斥”，这些被竞争的资源即称为临界资源/互斥资源/共享变量。在讨论进程互斥时，一般可以理解为这些进程间并不需要协作，即彼此无关，它们并不知道其它进程的存在，并且也不受其它进程执行的影响。

### 软件互斥方案
使用信号量（semaphore）作为同步工具。信号量 S 是个整数变量，除初始化外，它只能通过两个标准原子操作：wait()、signal() 来访问。这些操作原来成为 P （荷兰语 proberen，测试）和 V （荷兰语 verhogen，增加）。
信号量的主要缺点是都要求忙等待,忙等待浪费了 CPU 时钟，这本来可以有效地为其他进程所使用。这种类型的信号量也称为自旋锁。

### 硬件互斥方案：
使用硬件支持的特殊指令，来达到互斥的目的。
* 开/关中断
* 测试并加锁（Test and Set Lock, TSL)

