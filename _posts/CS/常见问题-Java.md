---
title: 常见问题-Java
date: 2018-05-26 09:54:02
categories: java
tags: [java, Q&A]
---
[toc]
# 锁
## 为什么产生死锁？
死锁发生于多道程序设计环境中，若干进程需要共享一些资源，而一个进程所需要的资源可能有多种类型，如打印机、内存块等，因此就有可能出现多个进程对相同资源的竞争和等待，不合理的推进顺序会导致这种竞争和等待会无限循环地僵持下去，形成环路，这种状态就是进程死锁。

## 如何检测死锁
死锁一旦出现，业务是可感知的，因为无法继续提供服务，这时候通过将线程信息dump出（通过jstack 或 vmvisual等工具），可以查看哪个线程出现了类似“Blocked”信息，即有可能该线程出现了死锁。

## 避免死锁的常用方法
* 避免一个线程同时获得多个锁；
* 避免一个线程在锁内同时占用多个资源，尽量保证每个锁只占用一个资源；
* 尝试使用定时锁，使用 lock.tryLock(timeout)来代替使用内部锁机制；
* 对于数据库锁，加锁和解锁必须在同一个数据库连接里，否则会出现解锁失败的情况。
etc.

## 什么时候需要同步？
* 如果一个变量正在被修改，而接下来它有可能被另一个线程读取，或者正在读取一个上一次已经被某个线程修改过的变量，就必须使用同步；
* 每个需要访问临界数据的方法都需要同步机制。