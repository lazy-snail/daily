---
title: Java-语法糖
date: 2018-04-27 14:52:39
categories: java
tags: [java]
---
### 关于语法糖（Syntactic Sugar）
也称糖衣语法，由英国计算机科学家 Peter J · Landin 发明的一个术语，指在计算机预言中添加的某种语法，这种语法对语言的功能并没有影响，但是更方便程序员使用。通常，使用语法糖能够增加程序的可读性，从而减少代码出错的机会。

Java 中最常用的语法糖主要有：泛型、内部类、自动装箱/拆箱、循环遍历、变长参数、条件编译等。JVM 运行时并不支持这些语法，它们在编译阶段还原回简单的基础语法结构，这个过程称为解语法糖。解语法糖的执行在 javac 中，查看 com.sun.tools.javac.main.JavaCompiler 源码可见，在 compile() 中有一个步骤是 desugar()。

### 泛型
Java 语言中的泛型（Since 1.5），本质是 **参数化类型（Parametersized Type）** 的应用：即，所操作的数据类型被指定为一个参数。这种参数类型可以用在类、接口和方法的创建中，分别称称为泛型类、泛型接口、泛型方法。它只存在于程序源码中，在编译后的字节码文件中，已经替换为原来的原生类型（Raw Type，也称裸类型），并且在相应地方插入了强制类型转换（运行期间，ArrayList<int> 和 ArrayList<String> 就是同一个类）。java 语言中泛型的这种实现方法被称为类型擦除，基于这种方法实现的泛型称为伪泛型（相对地，类似 C# 的“类型膨胀”实现方法则称为真实泛型）。

### 内部类
内部类分为 4 种：成员内部类、局部内部类、匿名内部类、静态内部类。从编译结果看，_内部类会编译出一个单独的 .class 文件。_
* 成员内部类：最常见的一种形式。特点：
不可以定义 static 方法；
private 类型对外不可见；public 类型对外可见；
成员内部类可以访问其外部类的私有属性，如果成员内部类的属性和其外部类的属性重名，则以成员内部类的属性值为准。

* 局部内部类：定义在一个方法或者特定作用域里面的类。特点：
没有访问修饰符；
局部内部类要访问外部的变量或者对象，该变量或对象的引用必须是用final修饰的。

* 匿名内部类：在多线程模块中大量使用了匿名内部类，使用方便，应用广泛。特点：
匿名内部类是唯一没有构造器的类；
用范围很有限，一般用于继承抽象类或实现接口（注意只能继承抽象类，不能继承普通类）；
Java自动为之起名为XXX$1.classs；
部内部类一样，要访问外部的变量或者对象，该变量或对象的引用必须是用 final 修饰的

* 静态内部类：用static修饰的内部类。特点：
可以有静态方法，也可以有非静态方法；
只能访问其外部类的静态成员与静态方法；
和普通的类一样，要访问静态内部类的静态方法，可以直接类名”.”方法名；要访问静态内部类的非静态方法，必须通过实例；
注意一下实例化成员内部类和实例化静态内部类这两种不同的内部类时写法上的差别
（1）成员内部类：外部类.内部类 XXX = 外部类.new 内部类();
（2）静态内部类：外部类.内部类 XXX = new 外部类.内部类();

### 条件编译
很多语言都提供了条件编译途径，如 C、C++ 中使用预处理器提示符（#ifdef、#endif）来完成条件编译。C、C++ 的预处理器最初的任务是解决编译时的代码依赖关系（如最常见的 #include 预处理命令）。而 java 编译方式则无须使用预处理器——编译器不是一个个地编译 java 文件，而是将所有编译单元的语法树顶级节点输入到待处理列表后再进行编译，因此各个文件之间能够提供符号信息。
java 中进行条件编译的方法是：**使用条件为常量的 if 语句**。

### 循环遍历 foreach
对于数组的 foreach 循环，javac 直接解析为普通的 for 循环；而对于 List、String 等类型，它们能使用 foreach 的基础是都实现了 Iterator 接口，即，javac 会使用该接口的 hasNetx() 方式完成遍历，这就意味着，需要保证要遍历的对象非空。

### 变长参数·   ··1
本质上是基于数组的实现。

#### 使用规则
* 优先匹配定长参数，如果匹配到多个含可变参数的方法，编译无法通过；
* 变长参数必须作为方法参数列表的最后一个参数，这句话同时隐含了：方法参数列表最多只能有一个可变长参数。

应该避免带有变长参数的方法重载，注意 null 值 和空值可能会影响到变长方法，正确方式是将一个指向 null 的 String 数组作为“可变长”参数传入。
