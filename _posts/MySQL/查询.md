---
title: 查询
date: 2018-04-17 10:05:20
categories: DB
tags: [DB, MySQL]
---
# 查询
## 一般的查询处理步骤
1. 语法分析与翻译
2. 优化
3. 执行
{% asset_img 通用查询处理.PNG 查询处理的步骤 %}

进一步的，MySQL 中处理查询的步骤：
1. 客户端发送一条查询给服务器。
2. 服务器先检查查询缓存（如果查询缓存是开的），如果命中，则直接返回缓存中的结果；否则进入下一步。
3. 服务器端进行 SQL 解析、预处理，再经优化器生成执行计划。
4. MysQL 根据优化器生成的执行计划，调用相应存储引擎的 API 来执行查询。
5. 返回结果给客户端。
{% asset_img MySQL查询处理.PNG MySQL 查询处理 %}


## 哪些因素导致性能下降
查询的生命周期是：从客户端到服务器，在服务器上进行解析，生成执行计划，执行，返回结果给客户端。其中“执行”可以看作最重要的阶段，它包括为检索数据而发起的所有存储引擎调用、调用中的数据处理（筛选、排序、分组等）等操作，这也是优化重点考虑的部分。此外的时间消耗如网络、CPU 计算、生成统计信息、锁操作等，这些的优化和查询优化没有直接关系。
而每个消耗大量时间的查询操作中，基本都有一些不恰当的操作：某些操作重复了很多次，某些操作执行很慢等，优化的目的就是减少和消除这些不必要的操作。

慢查询性能低下的一个主要原因是访问了不必要的数据，或者说访问的数据太多。某些查询可能不可避免地需要筛选大量数据，但这种操作并不多见。大部分性能低下的查询都可以通过减少访问的数据量来优化：
* 确认是否检索大量超过需要的数据，通常是访问了太多的行，也有可能是访问了不必要的列。
* 确认 MySQL 服务器层是否在分析大量超过需要的数据行。

# 慢查询



