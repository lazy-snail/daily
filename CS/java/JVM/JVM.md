---
title: JVM
date: 2018-06-04 21:32:49
categories: java
tags: [java, JVM]
---
[toc]

# 逃逸分析
一种有效减少 java 程序中同步负载和内存堆分配压力的跨函数全局数据流分析算法。通过逃逸分析，HotSpot 编译器能够分析出一个新建对象的引用的使用范围，从而决定是否在堆上分配该对象。
## 原理
在计算机语言编译器优化原理中，逃逸分析是指分析指针动态范围的方法，它同编译器优化原理的指针分析和外形分析相关联。当变量（对象）在方法中分配后，其指针有可能被返回或者被全局引用，这样就会被其他过程或者线程所引用，这种现象称作指针（或者引用）的逃逸(Escape)。通俗点讲，如果一个对象的指针被多个方法或者线程引用时，那么我们就称这个对象的指针发生了逃逸。
具体到 java 编译器中，我们知道对象总是在堆上分配的，因此对象的创建和回收对系统开销影响很大，不支持栈上分配对象也是 java 被批评的原因之一。考虑一种普遍场景：一般在方法体内，声明一个局部变量，该变量在方法执行生命周期内并非发生逃逸，但是按照 JVM 内存分配机制（未优化前），还是会首先在堆上创建该对象，然后将该对象的引用压入方法栈。而开启逃逸分析优化后（-XX:+DoEscapeAnalysis），JVM 会分析并找出未逃逸的变量，将该变量的实例化内存直接在栈上分配，无需进入堆，最后线程执行结束，栈空间被回收，栈上的局部对象也被回收，从而避免 GC 管理回收这部分对象。

http://www.importnew.com/27262.html